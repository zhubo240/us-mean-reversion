# Shiller 完整数据集与 Compustat 交叉验证

## 概述

使用 Robert Shiller 1871-2025 年完整年度数据（Price, PE, Dividend Yield），将分析窗口从 39 年（Compustat 1985-2024）扩展到 153 年，并在重叠区间交叉验证两套数据源的一致性。

## 数据来源

| 数据集 | 来源 | 时间跨度 | 粒度 |
|--------|------|----------|------|
| **Shiller** | multpl.com / Shiller CAPE dataset | 1871-2025 | 指数级别（每年1月值） |
| **Compustat** | CRSP/Compustat Merged | 1985-2024 | 公司级别（~500家/年） |

### Shiller 数据字段
- **Price**: S&P 500 指数价格（每年1月）
- **PE**: 滞后12个月 PE 比率
- **Dividend Yield**: 滞后12个月股息率
- **EPS**: 衍生值 = Price / PE（非原始字段）
- **Dividends/share**: 衍生值 = Price × DivYield

### EPS 衍生值精度
| 年份 | 衍生 EPS | Shiller 原始 EPS | 偏差 |
|------|---------|-----------------|------|
| 1928 | 1.13 | 1.58 | -28.3% |
| 1950 | 2.34 | 2.34 | -0.1% |
| 1985 | 16.56 | 14.61 | +13.4% |
| 2000 | 49.09 | 52.15 | -5.9% |
| 2024 | 192.10 | 197.78 | -2.9% |

早期偏差较大（PE 定义差异），近年 <5%。由于分解分析使用增长率（比率），绝对值偏差不影响趋势。

---

## 153 年回报分解（1872-2025）

### 全期 CAGR

```
名义总回报 CAGR:  9.01%
  = 盈利增长:     4.18%
  + PE 扩张:      0.56%
  + 平均股息率:   4.25%
```

- **Price**: 4.86 → 5,979.52（1,230 倍）
- **EPS**: 0.40 → 212.34（530 倍）
- **PE**: 12.1 → 28.2

### 关键结论
PE 扩张在 153 年中仅贡献 0.56%/年，说明长期回报几乎完全由 **盈利增长 + 股息** 驱动。

---

## 滚动窗口均值回归统计（153 年）

| 窗口 | 总回报 | 盈利增长 | PE 扩张 | 股息率 | 标准差 | 范围 |
|------|--------|---------|--------|--------|--------|------|
| **5年** | 9.26% | 4.59% | 0.91% | 4.25% | 7.29% | [-10.2%, +27.7%] |
| **10年** | 9.10% | 4.30% | 0.64% | 4.25% | 4.74% | [-1.9%, +18.8%] |
| **20年** | 9.01% | 4.31% | 0.42% | 4.29% | 3.04% | [+3.2%, +16.9%] |
| **30年** | 9.22% | 4.43% | 0.41% | 4.37% | 2.08% | [+5.1%, +13.2%] |
| **50年** | 9.23% | 4.38% | 0.32% | 4.51% | 1.75% | [+5.6%, +13.0%] |

### 均值回归证据
1. **PE 扩张收敛**：5 年 0.91% → 50 年 0.32%，趋近零
2. **波动率收敛**：5 年 σ=7.29% → 50 年 σ=1.75%（缩小 4.2 倍）
3. **回报范围收窄**：5 年跨度 37.9pp → 50 年跨度 7.4pp
4. **20 年以上无负回报**：最低 +3.2%（20 年窗口）

### 与 39 年 Compustat 分解对比

| 指标 | 153 年 (Shiller) | 39 年 (Compustat) |
|------|-----------------|-------------------|
| 总名义回报 | 9.01% | 12.65% |
| 盈利增长 | 4.18% | 7.33% |
| PE 扩张 | 0.56% | 2.71% |
| 股息率 | 4.25% | 2.42% |

差异说明：
- 1985-2024 是美国股市特殊的牛市周期（PE 从 10 扩张到 27）
- 153 年视角下 PE 扩张几乎可忽略
- 股息率从早期 >5% 下降到近年 <2%，拉低了全期均值

---

## 交叉验证：Shiller vs Compustat（1985-2023）

### 年份对齐方法
- **Shiller**: 每年1月值，年度回报 = Jan(Y) → Jan(Y+1) ≈ 日历年 Y
- **Compustat**: 财年末值，年度回报 = Dec(Y-1) → Dec(Y) = 日历年 Y
- 对齐：Shiller 的 `year Y+1` 条目 ↔ Compustat 的 `year Y`（约1个月时差）

### 汇总统计

| 指标 | 均值差 (Δ) | 标准差 (σ) | 范围 |
|------|-----------|-----------|------|
| **价格回报** | -0.5pp | 5.4pp | [-13pp, +12pp] |
| **EPS 增长** | -2.1pp | 68.2pp | [-317pp, +229pp] |
| **PE 比率** | -2.4 | 15.0 | [-87, +10] |
| **股息率** | -0.25pp | 0.43pp | — |

### 长期均值对比

| 指标 | Shiller | Compustat | 差异 |
|------|---------|-----------|------|
| **平均价格回报** | 10.20% | 10.69% | -0.5pp |
| **平均股息率** | 2.19% | 2.44% | -0.25pp |
| **平均总回报** | 12.39% | 13.13% | **-0.7pp** |

### 验证结论

1. **价格回报高度一致**：39 年均值差仅 -0.5pp，年际波动 σ=5.4pp 主要源于 1 个月的日历时差（Jan vs Dec）
2. **EPS 增长年际差异大**：危机/恢复年份（2002-2003, 2008-2009）差异极端（±300pp），因 Shiller 用 Price/PE 衍生 EPS、Compustat 用报告净利润，分母趋近零时放大差异
3. **股息率一致**：均值差 -0.25pp，稳定可靠
4. **总回报长期吻合**：Shiller 12.39% vs Compustat 13.13%，仅差 0.7pp
5. **结论**：两套独立数据源在长期总回报上高度一致，验证通过

### 典型一致年份（|价格回报差| < 2pp）

| 年份 | Shiller 回报 | Compustat 回报 | Δ |
|------|-------------|---------------|---|
| 2001 | -14.6% | -14.7% | +0.0pp |
| 2002 | -21.4% | -21.1% | -0.3pp |
| 2010 | +14.1% | +14.0% | +0.2pp |
| 2017 | +18.6% | +18.5% | +0.1pp |
| 2023 | +21.3% | +21.3% | +0.0pp |

### 差异较大年份及原因

| 年份 | Δ 价格回报 | 原因 |
|------|-----------|------|
| 1987 | -8.9pp | 10月黑色星期一 — Jan vs Dec 端点捕获不同 |
| 2000 | -13.4pp | 科技泡沫顶峰 — 12月/1月差异放大 |
| 2016 | +10.3pp | 年末反弹 — Trump 当选后12月大涨 |
| 2018 | -3.5pp | 12月大跌 — 2019年1月反弹使 Shiller 偏低 |

---

## 文件清单

| 文件 | 说明 |
|------|------|
| `code/shiller_complete.py` | 完整数据集 + 分解 + 滚动窗口 + 交叉验证 |
| `data/shiller_complete.json` | 输出 JSON（年度数据 + 分解 + 滚动窗口） |

### 运行

```bash
cd sp500_project_export
python3 code/shiller_complete.py
```

---

**完成日期**：2025年2月
