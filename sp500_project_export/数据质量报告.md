# CRSP/Compustat 数据质量报告

## 数据概览

| 文件 | 大小 | 行数 | 说明 |
|------|------|------|------|
| crsp_monthly.csv | 369MB | 5,158,018 | CRSP 月度股票数据 |
| compustat_annual.csv | 72MB | 593,948 | Compustat 年度财务数据 |
| ccm_link_table.csv | 2.2MB | 32,759 | CRSP-Compustat 关联表 |
| sp500_constituents.csv | 58KB | 2,064 | S&P 500 成分股历史 |

---

## 一、CRSP 月度数据

### 基本信息

| 指标 | 值 |
|------|-----|
| 时间范围 | 1926-01 至 2024-12（99年） |
| 唯一股票数（PERMNO） | 38,843 |
| 重复记录 | 0（无重复） |

### 字段结构

| 字段 | 说明 |
|------|------|
| PERMNO | 永久证券标识符 |
| date | 月末日期（YYYY-MM-DD） |
| SICCD | SIC 行业代码 |
| TICKER | 股票代码 |
| COMNAM | 公司名称 |
| DLRET | 退市回报 |
| PRC | 价格 |
| RET | 月度回报率 |
| SHROUT | 流通股数 |

### 缺失值统计

| 字段 | 缺失数 | 占比 |
|------|--------|------|
| date | 0 | 0.0% |
| PERMNO | 0 | 0.0% |
| RET（空值） | 88,683 | 1.7% |
| PRC（空值） | 154,478 | 3.0% |
| SHROUT（空值） | 41,476 | 0.8% |
| SICCD（空值） | 36,802 | 0.7% |
| TICKER（空值） | 498,069 | 9.7% |

TICKER 缺失率最高（9.7%），主要是早期记录缺少股票代码，不影响分析。

### 需要处理的问题

**1. 非数值回报代码（105,934行，2.1%）**

| 代码 | 数量 | 含义 |
|------|------|------|
| B | 65,780 | 无有效前期价格，无法计算回报 |
| C | 40,154 | 无有效当期价格，无法计算回报 |

处理：计算回报率时过滤掉这些行。

**2. 负价格（816,857行，15.8%）**

CRSP 惯例：负价格表示没有收盘价，使用买卖价中间值的负数。计算市值时取绝对值：`市值 = |PRC| × SHROUT`。

**3. 退市回报（DLRET）**

| DLRET 值 | 数量 | 含义 |
|----------|------|------|
| A | 9,740 | 仍活跃/未退市 |
| 数值 | 28,932 | 实际退市回报 |
| -1.000000 | 391 | 退市完全亏损 |
| 0.000000 | 2,080 | 退市无损益 |
| S | 171 | CRSP 停止追踪 |

**必须将 DLRET 纳入回报计算，否则存在幸存者偏差。** 391 条完全亏损（-1.0）尤其重要。

**4. 极端回报**

| 指标 | 值 |
|------|-----|
| 最大月回报 | +3,900%（39.0） |
| 最小月回报 | -99.58%（-0.9958） |
| RET = -1.0 | 0 条 |

最大月回报 3900% 极端但可能，来自微型股。按市值加权计算时影响可忽略。

### 各年代覆盖

| 年代 | 行数 | 约月均股票数 |
|------|------|------------|
| 1920s | 29,459 | ~614 |
| 1930s | 89,817 | ~748 |
| 1940s | 104,025 | ~867 |
| 1950s | 126,659 | ~1,056 |
| 1960s | 232,317 | ~1,936 |
| 1970s | 544,572 | ~4,538 |
| 1980s | 764,526 | ~6,371 |
| 1990s | 980,364 | ~8,170 |
| 2000s | 878,522 | ~7,321 |
| 2010s | 860,612 | ~7,172 |
| 2020s | 547,145 | ~9,119 |

1960s 起覆盖面大幅扩展（加入 NASDAQ/AMEX）。

---

## 二、Compustat 年度数据

### 基本信息

| 指标 | 值 |
|------|-----|
| 时间范围 | 1950 至 2025 |
| 唯一公司数（gvkey） | 46,670 |
| 币种 | 88.2% USD，11.8% CAD |

### 关键字段

| 字段 | 说明 |
|------|------|
| gvkey | Compustat 全局公司标识 |
| datadate | 财年末日期 |
| tic | 股票代码 |
| conm | 公司名称 |
| curcd | 报告币种 |
| prcc_f | 财年末收盘价 |
| csho | 流通股数 |
| ni | 净利润 |
| epspx | 基本 EPS（不含特殊项） |
| sich | 历史 SIC 行业代码 |

### 需要处理的问题

**1. 加拿大公司（11.8%）**

做美股分析需要过滤：`curcd = 'USD'`。

**2. 缺失价格和 EPS（约 20%）**

主要是早期数据和非上市公司。分析时按需过滤。

**3. EPS 极端异常值**

少数记录 `|EPS| > 10,000`，原因是流通股接近零导致除法放大。处理：过滤 `csho > 某个阈值`（如 > 0.1百万股）。

**4. 亏损公司（34.6%）**

34.6% 的公司年报告净利润 < 0，这是正常现象。

**5. 退市公司（62.9%）**

62.9% 的公司已退市。这是**好事** — 说明数据库保留了完整历史记录，没有幸存者偏差。

---

## 三、CCM 关联表

### 基本信息

| 指标 | 值 |
|------|-----|
| 记录数 | 32,759 |
| 唯一 gvkey | 28,168 |
| 唯一 PERMNO | 28,801 |
| 主要关联（LINKPRIM = P 或 C） | 98.4% |
| 活跃关联（LINKENDDT = "E"） | 6,077 |

### 注意事项

- 678 个一对多映射（1 个 PERMNO 对应多个 gvkey），是公司重组导致的，正常
- 使用时按 `LINKPRIM IN ('P','C')` 和 `LINKTYPE IN ('LU','LC')` 过滤取主要关联

---

## 四、S&P 500 成分股历史

### 基本信息

| 指标 | 值 |
|------|-----|
| 记录数 | 2,064 |
| 唯一公司（PERMNO） | 1,936 |
| 时间范围 | 1925 至 2024 |
| 当前活跃 | 503 条 |
| 多次进出的公司 | 119 家 |

### 数据质量

- 91.6% 的 PERMNO 能关联到 CCM
- 缺失关联的 163 个 PERMNO 主要是 1960s 以前的老公司，影响有限

---

## 五、使用建议

### 必须处理（影响分析正确性）

| 问题 | 处理方式 |
|------|---------|
| CRSP 非数值回报（B/C 代码） | 过滤掉，视为缺失值 |
| CRSP 负价格 | 取绝对值后计算市值 |
| CRSP 退市回报（DLRET） | 纳入回报计算，避免幸存者偏差 |
| Compustat 加拿大公司 | 过滤 `curcd = 'USD'` |
| Compustat EPS 极端值 | 过滤 `csho > 阈值` |

### 可选处理（提高分析质量）

| 问题 | 处理方式 |
|------|---------|
| CRSP 极端月回报（>1000%） | 按市值加权时影响小，可选择封顶 |
| 1960 前 163 个 PERMNO 无 CCM | 接受缺失或手动补充 |
| Compustat 财年非 12 月 | 按 `fyr` 字段对齐日历年 |

### 数据关联方式

```
CRSP (PERMNO) ←→ CCM (LPERMNO ↔ gvkey) ←→ Compustat (gvkey)
S&P 500 成分股 (PERMNO) ←→ CRSP (PERMNO)
```

过滤条件：
- CCM: `LINKPRIM IN ('P','C')` 且 `LINKTYPE IN ('LU','LC')`
- Compustat: `curcd = 'USD'`
- CRSP 回报: 排除 RET 为 'B' 或 'C' 的行

---

*报告创建时间：2026-02-20*
*数据来源：WRDS (Wharton Research Data Services)*
