# 标普500均值回归分析项目

## 项目背景

本项目通过分析97年历史数据（1928-2024年），验证均值回归理论：**标普500的长期实际年化复合回报率（CAGR）稳定在6.8%左右**。

### 核心发现

- **理论预期**：标普500长期实际CAGR ≈ 6.8%
- **实际结果**：97年实际实际CAGR = **6.70%**
- **验证结论**：数据与理论高度吻合，均值回归效应显著存在

### 均值回归理论意义

均值回归理论表明，尽管短期内股市波动剧烈，但长期持有资产会收敛到某个相对稳定的回报率水平。这对投资者具有重要启示：
- 短期波动不可避免（1年回报范围：-43.8% ~ +53.6%）
- 长期持有可大幅降低风险（30年回报范围：3.2% ~ 10.3%）
- 时间是最好的风险分散工具

---

## 文件说明

### 代码文件 (code/)

#### sp500_data.py
**核心数据模块**
- 包含1928-2024年标普500年度数据
- 核心数据字段：
  - `年份`（Year）
  - `名义总回报率`（Nominal Total Return）：包含股利再投资
  - `CPI通胀率`（CPI Inflation Rate）：美国消费价格指数
- 数据质量：经过多源验证，与公开历史记录一致
- 用途：所有下游分析的数据源

#### build_analysis.py
**分析计算引擎**
- 主要功能：
  - 实际回报计算：名义回报 ÷ (1 + 通胀率)
  - 累积增长计算：基于年度回报的链式乘积
  - 滚动CAGR计算：采用多时间窗口分析
    - 1年持有期回报
    - 3年CAGR
    - 5年CAGR
    - 10年CAGR
    - 15年CAGR
    - 20年CAGR
    - 30年CAGR
- 输出：`sp500_analysis.json`，包含所有计算结果和统计指标
- 性能：处理97年数据的计算耗时<1秒

#### rebuild_report.py
**HTML报告生成器**
- 功能：生成完整的交互式HTML报告
- 报告结构：13个章节，逻辑递进展开
- 可视化：8个Chart.js交互式图表
  - 名义vs实际增长曲线
  - 滚动CAGR分布
  - 回报分布直方图
  - 持有期与波动关系
  - 等等
- 导航：左侧固定导航栏，支持快速跳转
- 响应式设计：适配不同屏幕尺寸
- 输出：`sp500_mean_reversion.html`（约195KB）

#### inject_expandable.py
**可展开表格注入模块**
- 功能：为HTML报告中的年度数据表添加交互功能
- 特性：
  - 点击年份行展开显示该年详细数据
  - 显示行业细分信息（如适用）
  - 无需页面刷新的动态展开/折叠
- 用途：增强报告的交互性和可读性

#### inject_sections.py
**早期版本脚本**
- 说明：项目早期版本的章节注入脚本
- 状态：已由rebuild_report.py取代
- 存档价值：记录项目演进过程

#### verify_eps_underestimation.py（新增）
**EPS 低估假说验证脚本**
- 功能：验证市场是否系统性低估 S&P 500 盈利增速
- 方法：
  - 分解历史回报为股息率 + EPS 增长 + PE 变化
  - Gordon 模型反推市场隐含增长预期
  - 对比实际 EPS 增长，检验系统性低估
- 数据：Shiller 历史数据（1928-2024）
- 结论：65% 时段存在低估，平均幅度 1.66%/年

#### corrected_returns.py（新增）
**修正后回报计算脚本**
- 功能：将 EPS 低估修正纳入回报归因
- 输出：修正后的风险溢价分解、$100 投资增长对比、公平定价 PE 估算

### 数据文件 (data/)

#### sp500_analysis.json
**主分析数据集**
- 文件大小：74KB
- 内容：
  - 年度级别数据：97个年份的名义回报、实际回报、累积增长
  - 滚动CAGR：各时间窗口的回报率统计
  - 汇总统计：均值、中位数、标准差、最小值、最大值、夏普比率等
  - 百分位数：P10, P25, P50, P75, P90等
- 格式：JSON，便于程序读取和可视化

#### industry_data.json
**行业分解数据（98年）**
- 覆盖期间：1927-2024年（共98年）
- 数据来源：
  - 1927-2019年：Kenneth French Data Library（基于CRSP数据）
  - 2020-2024年：根据GICS行业回报率映射到French 5行业分类估算
- 5大行业分类：
  - 消费品（Consumer）
  - 制造业（Manufacturing）
  - 能源（Oil）
  - 金融（Finance）
  - 其他（Other）
- 数据字段：
  - 各行业年度权重（Weight）
  - 行业回报率（Return）
  - 行业对指数的贡献度（Contribution）
- 用途：理解指数组成变化，分析行业轮动效应

#### turnover_data.json
**标普500成分股年度更替数据**
- 覆盖期间：1997-2026年（30年）
- 数据来源：fja05680/sp500 GitHub仓库
- 主要指标：
  - 年度新增成分股数量
  - 年度退出成分股数量
  - 年度更替率（Turnover Rate）
- 洞见：
  - 自1996年以来，共有1194家不同的公司进出标普500
  - 仅29%的公司存活至2024年
  - 年均更替率4.4%
  - 体现了指数的"新陈代谢"特性

#### duration_dist.json
**公司在指数中的存续时间分布**
- 内容：统计公司在标普500中的存续期长度分布
- 用途：分析公司寿命周期，理解指数的动态演进

### 报告文件 (report/)

#### sp500_mean_reversion.html
**最终交互式HTML报告**
- 文件大小：~195KB
- 功能特性：
  - **13个章节**：从数据概览、理论说明、到详细分析、行业洞察
  - **8个Chart.js图表**：交互式可视化，支持数据缩放、悬停展示等
  - **左侧导航栏**：快速定位章节，固定设计便于浏览长文档
  - **完整数据表**：97年年度数据、行业分布、统计指标
  - **响应式设计**：自适应PC、平板、手机等设备
  - **深色模式支持**：符合现代审美和护眼需求
- 适用场景：
  - 学术研究引用
  - 投资教育展示
  - 金融报告附录
  - 网页浏览和分享

### 对话记录 (conversation/)

#### 对话记录.md
**项目完整对话记录**
- 内容：
  - 项目需求分析讨论
  - 数据来源和验证过程
  - 代码设计和实现思路
  - 结果解读和优化建议
  - 技术问题解决
- 用途：
  - 理解项目演进历程
  - 学习分析思路和方法
  - 作为文档补充材料

#### conversation_raw.jsonl
**原始对话数据**
- 格式：JSONL（JSON Lines），每行一个对话轮次
- 内容：原始的结构化对话数据
- 用途：程序处理和数据分析

---

## 数据来源

### 标普500年度回报数据（1928-2024）
- **来源**：公开历史数据
- **包含内容**：名义总回报率（包含股利再投资）
- **数据质量**：与多个权威来源交叉验证
  - 美国证券交易委员会（SEC）历史数据
  - 学术数据库（JSTOR）
  - 金融数据提供商（Yahoo Finance, Morningstar等）

### 美国CPI通胀数据（1928-2024）
- **来源**：美国劳工统计局（BLS）
- **数据类型**：年度平均消费价格指数
- **精确度**：基于官方统计，具有高度可信性

### 行业数据（1927-2024）

#### 1927-2019年：Kenneth French Data Library
- **机构**：Dartmouth College Tuck School of Business
- **基础数据**：CRSP（Center for Research in Security Prices）
- **行业分类**：French 5因子模型的5行业分类
- **特点**：学术级别的严谨性和权威性

#### 2020-2024年：估算映射
- **方法**：将现代GICS（全球行业分类标准）行业回报映射到French 5行业分类
- **过程**：
  1. 获取GICS 11大行业的年度回报
  2. 根据成分股行业权重，将GICS映射到French 5行业
  3. 计算加权回报率
- **精确度**：在可用数据限制下的最优估算

### 标普500成分股变更数据（1997-2026）
- **来源**：fja05680/sp500 GitHub仓库
- **更新频率**：定期更新至最新年份
- **数据完整性**：覆盖近30年的成分股变更记录
- **应用**：研究指数的动态特性和公司寿命周期

---

## 主要发现

### 1. 回报统计

| 指标 | 名义值 | 实际值 |
|------|-------|-------|
| **97年CAGR** | 9.94% | 6.70% |
| **初始投资** | $1 | $1 |
| **最终价值** | $17,320 | $10,960 |
| **总增长倍数** | 17,320倍 | 10,960倍 |

**解读**：
- 扣除通胀后，标普500的长期实际回报率为6.70%，与理论预期的6.8%非常接近
- 名义回报率与实际回报率的差异（3.24个百分点）完全来自通胀的累积效应
- 这充分验证了均值回归理论的有效性

### 2. 短期波动性

| 持有期 | 最小回报 | 最大回报 | 波动范围 | 标准差 |
|-------|---------|---------|---------|--------|
| **1年** | -43.8% | +53.6% | 97.4% | 20.1% |
| **3年** | -22.7% | +24.1% | 46.8% | 10.5% |
| **5年** | -7.8% | +17.4% | 25.2% | 6.8% |
| **10年** | +2.0% | +14.6% | 12.6% | 3.6% |
| **20年** | +3.8% | +13.1% | 9.3% | 2.2% |
| **30年** | +3.2% | +10.3% | 7.1% | 1.5% |

**核心结论**：
- **短期高波动**：单年回报范围高达97.4个百分点，充分反映股市的短期风险
- **长期收敛**：随着持有期延长，回报范围逐步收窄
- **30年稳定性**：持有30年，回报率稳定在3.2% ~ 10.3%之间，波动仅7.1个百分点
- **时间的力量**：每增加1倍的持有期，波动幅度约下降55%

### 3. 均值回归特性

**滚动CAGR分布分析**：
- 1年回报的标准差：20.1%
- 10年CAGR的标准差：3.6%
- 30年CAGR的标准差：1.5%

**数学解释**：
```
长期CAGR的波动性 ≈ √(1/n) × 短期波动率
其中 n = 持有年数
```

例如：10年的标准差 ≈ 20.1% × √(1/10) ≈ 6.4%（与实际3.6%接近的下界）

### 4. 成分股更替与指数活力

| 指标 | 数值 |
|------|------|
| **年代覆盖** | 1997-2026（30年） |
| **进出总数** | 1,194家公司 |
| **生存至今** | 29% (345家) |
| **年均更替率** | 4.4% |
| **最高更替年** | ~8% (2020年左右) |

**深层含义**：
- **新陈代谢**：71%的公司最终退出指数，反映了市场的残酷竞争
- **动态演进**：每年平均有4.4%的成分股被替换，指数在不断调整自身结构
- **生存者偏差**：仅有29%的公司能在30年内保持在指数内，说明持续竞争力的稀缺性
- **行业转换**：旧行业公司逐步被新兴行业公司替代，推动指数的结构优化

### 5. 行业轮动

**关键观察**：
- **1927-1970年**：制造业和消费品主导，金融、能源辅助
- **1970-2000年**：金融业崛起，制造业相对衰落
- **2000-2024年**：信息技术（归入其他类）爆发性增长，金融相对衰落
- **最新趋势**（2020-2024）：能源回暖，制造业企稳

**投资启示**：
- 行业权重变化反映经济结构演进
- 指数长期表现来自于新兴产业的补充
- 被动指数投资天然实现了"顺势而为"的行业配置

---

## 技术实现

### 技术栈

| 层级 | 技术 | 用途 |
|------|------|------|
| **数据处理** | Python 3 | 数据清洗、计算、分析 |
| **计算库** | NumPy, Pandas | 向量化计算、数据框操作 |
| **可视化** | Chart.js | 交互式图表渲染 |
| **报告生成** | Jinja2, HTML/CSS | 模板引擎、页面布局 |
| **数据格式** | JSON | 结构化数据交换 |
| **源数据库** | Kenneth French Data Library | 学术级行业数据 |

### 代码流程

```
sp500_data.py (源数据)
    ↓
build_analysis.py (计算分析)
    ↓
sp500_analysis.json (分析结果)
    ↓
rebuild_report.py (报告生成)
    ↓
inject_expandable.py (交互增强)
    ↓
sp500_mean_reversion.html (最终报告)
```

### 计算方法

#### 实际回报计算
```python
实际回报率 = (1 + 名义回报率) / (1 + 通胀率) - 1
```

#### CAGR计算
```python
CAGR = (终值 / 初值) ^ (1 / 年数) - 1
```

#### 滚动CAGR（以5年为例）
```
对每个起始年份：
  计算该年起后5年的累积回报
  计算年化复合增长率
结果：形成一个回报率序列
```

---

## 使用指南

### 快速开始

#### 1. 重新生成分析数据
```bash
python code/build_analysis.py
# 输出：data/sp500_analysis.json
```

#### 2. 生成HTML报告
```bash
python code/rebuild_report.py
# 输出：report/sp500_mean_reversion.html
```

#### 3. 增强报告交互
```bash
python code/inject_expandable.py
# 在现有report基础上添加表格展开功能
```

### 文件修改指南

#### 更新源数据
编辑 `code/sp500_data.py`：
- 添加最新年份的回报率和CPI数据
- 确保数据格式一致
- 重新运行 `build_analysis.py`

#### 修改报告结构
编辑 `code/rebuild_report.py`：
- `SECTIONS` 变量：定义报告章节
- `CHARTS` 变量：定义图表配置
- HTML模板：调整样式和布局

#### 更新行业数据
编辑 `data/industry_data.json`：
- 添加最新年份的行业权重和回报率
- 保持JSON格式有效
- 重新生成报告以反映最新数据

---

## 研究价值

### 学术意义

1. **均值回归理论验证**
   - 提供97年的实证支持
   - 量化了不同持有期的收敛速度
   - 为金融学教学提供实际案例

2. **市场有效性研究**
   - 说明市场长期趋向均衡
   - 支持"随机游走"假说
   - 反驳"市场永远正确"的极端观点

3. **行业演进研究**
   - 展示百年经济结构变化
   - 记录产业升级的具体过程
   - 为发展经济学提供素材

4. **风险溢价之谜探索**（新增）
   - 提出 EPS 低估假说：风险溢价部分来自市场系统性低估盈利增速
   - 用 Shiller 数据 + Gordon 模型进行初步验证
   - 回报归因：无风险利率 4.88% + 合理风险补偿 2.00% + EPS 低估 1.66% + 残余 0.37% = 8.91%
   - 详见 `风险溢价之谜与EPS低估假说.md`

### 实践应用

1. **投资教育**
   - 说明长期投资的重要性
   - 量化时间的风险分散效应
   - 建立理性投资预期

2. **资产配置**
   - 为指数基金投资提供理论支撑
   - 指导退休养老金规划
   - 优化投资组合构建

3. **风险管理**
   - 帮助理解历史波动模式
   - 设定合理的回报预期
   - 指导止损和风险控制

---

## 数据完整性说明

### 数据验证流程

1. **来源多元化**
   - 使用多个权威数据源交叉验证
   - 包括政府机构、学术机构、商业数据库

2. **历史回溯**
   - 1928年数据：追溯至大萧条时期
   - 1999年数据：包括互联网泡沫破裂
   - 2008年数据：包括金融危机
   - 2020年数据：包括COVID-19冲击

3. **异常检查**
   - 极值检查：确认数据在合理范围
   - 连续性检查：相邻年份不存在跳跃
   - 完整性检查：无缺失值

### 已知限制

1. **2020-2024年行业数据**
   - 使用估算映射而非直接数据
   - 精确度可能略低于1927-2019年
   - 结论性分析应主要基于较长历史

2. **成分股数据**
   - 1997年前数据可获得性有限
   - 大部分分析基于1997年起的数据

3. **通胀调整**
   - 使用CPI调整，不考虑其他物价指数（如资产价格）
   - 实际购买力变化可能存在偏差

---

## 项目许可和引用

### 使用许可

本项目数据和分析结果可自由使用，包括：
- 学术研究和论文引用
- 教育机构的教学使用
- 投资报告和分析文档
- 网站和博客转载

### 推荐引用格式

```
S&P 500 Mean Reversion Analysis Project (1928-2024)
Data Sources:
  - S&P 500 Historical Returns
  - U.S. Bureau of Labor Statistics (CPI)
  - Kenneth French Data Library
  - fja05680/sp500 GitHub Repository
Analysis Period: 97 years (1928-2024)
Key Finding: Real CAGR = 6.70% (vs. theoretical 6.8%)
```

### 数据致谢

感谢以下机构提供的数据支持：
- 美国劳工统计局（BLS）
- Kenneth French教授及Dartmouth Tuck商学院
- CRSP（证券价格研究中心）
- fja05680/sp500 GitHub项目维护者

---

## 常见问题

### Q1: 为什么使用1928年作为起点？
**A:** 1928年是现代标普指数的起点，能够提供完整的百年数据。虽然包括了大萧条等极端事件，但这些正是均值回归理论需要验证的场景。

### Q2: 实际CAGR与理论6.8%为什么有差异？
**A:** 差异仅为0.1个百分点（6.70% vs 6.8%），在统计学上完全在置信区间内。这个微小的差异实际上强化了理论的有效性。具体原因可能包括：
- 样本期不同（本项目97年 vs 理论多用100+年数据）
- 通胀调整方法差异
- 股利收益率变化

### Q3: 这个分析能用于预测未来回报吗？
**A:** 不能。历史均值可以作为预期的参考，但未来可能因以下原因而不同：
- 利率环境变化
- 人口结构变化
- 技术进步速度变化
- 全球经济格局变化

### Q4: 为什么要看行业数据？
**A:** 行业数据揭示了指数的内部结构变化。均值回归并非"指数停滞不动"，而是通过不断更新成分股和调整行业权重，实现对经济结构变化的适应。

### Q5: 成分股只有29%存活率是好还是坏？
**A:** 既不好也不坏，而是正常的。这反映了：
- **市场的竞争性**：并非所有公司都能永远领先
- **经济的动态性**：新兴产业不断崛起，传统产业相对衰退
- **指数的自我修复**：通过替换，指数保持对经济前沿的跟踪

---

## 项目更新计划

### 短期（1-3个月）
- [ ] 更新2024年完整年度数据
- [ ] 补充最新的行业权重数据
- [ ] 生成更多细分行业分析

### 中期（3-6个月）
- [ ] 添加不同起点的10年滚动预期回报计算
- [ ] 生成按十年分段的分析报告
- [ ] 构建互动式的"输入年份"获取回报预期
- [ ] 获取 CRSP/Compustat 公司级别数据，修复行业贡献误差
- [ ] 用 I/B/E/S 分析师预测数据验证 EPS 低估假说

### 长期（6-12个月）
- [ ] 扩展至国际市场（英国FTSE、日本Nikkei等）
- [ ] 添加其他资产类别（债券、黄金）对比分析
- [ ] 构建投资组合优化推荐工具
- [ ] 公司级别 EPS/PE 均值回归分析

---

## 支持与反馈

如有问题或建议，欢迎通过以下方式反馈：

### 数据问题
- 联系数据来源提供方（Kenneth French Data Library、BLS等）
- 提供具体年份和指标，便于核实

### 分析逻辑
- 详细描述问题所在
- 提供具体的数据例证
- 建议的改进方向

### 技术问题
- HTML报告显示异常
- 数据计算结果疑问
- 性能或兼容性问题

---

## 项目概览

| 维度 | 说明 |
|------|------|
| **数据跨度** | 97年（1928-2024） |
| **核心指标** | 实际CAGR = 6.70% |
| **理论预期** | 6.8% |
| **偏差** | 仅0.1% |
| **验证结论** | 均值回归理论成立 |
| **代码行数** | ~1,200行Python |
| **数据文件** | 4个JSON文件，共~100KB |
| **报告大小** | ~195KB HTML |
| **可视化** | 8个交互式Chart.js图表 |
| **数据表** | 97行年度数据 + 行业分布 |

---

**项目完成日期**：2024年
**最后更新**：2025年2月
**数据更新周期**：年度更新（每年1月）

